<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPv4 Calculator</title>
    
    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="IP Calculator v4">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="IP Calculator v4">
    <meta name="theme-color" content="#007AFF">
    <meta name="description" content="Modern IP subnet calculator with multi-format display">
    
    <!-- Icons for PWA -->
    <link rel="apple-touch-icon" sizes="180x180" href="icon.png">
    <link rel="icon" type="image/png" href="icon.png">
    
    <!-- Web App Manifest -->
    <link rel="manifest" href="manifest.json">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f0f0f0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .window {
            background: #e8e8e8;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            max-width: 1000px;
            margin: 0 auto;
            overflow: hidden;
        }
        
        .titlebar {
            background: linear-gradient(to bottom, #e8e8e8, #d0d0d0);
            height: 40px;
            display: flex;
            align-items: center;
            padding: 0 15px;
            border-bottom: 1px solid #c0c0c0;
            position: relative;
        }
        
        .traffic-lights {
            display: flex;
            gap: 8px;
        }
        
        .traffic-light {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 0.5px solid rgba(0,0,0,0.2);
        }
        
        .red { background: #ff5f57; }
        .yellow { background: #ffbd2e; }
        .gray { background: #28ca42; opacity: 0.3; }
        
        .title {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            font-weight: 500;
            color: #333;
            font-size: 14px;
        }
        
        .about-btn {
            position: absolute;
            right: 15px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #007AFF;
            color: white;
            border: none;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .about-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .about-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .about-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
        }
        
        .about-info {
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        
        .about-link {
            color: #007AFF;
            text-decoration: none;
            word-break: break-all;
        }
        
        .about-link:hover {
            text-decoration: underline;
        }
        
        .close-about {
            background: #007AFF;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .close-about:hover {
            background: #0056CC;
        }
        
        .content {
            padding: 20px;
            background: #f8f8f8;
        }
        
        .mode-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }
        
        .mode-btn {
            padding: 10px 20px;
            border: 2px solid #d0d0d0;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: #666;
            transition: all 0.2s ease;
        }
        
        .mode-btn:hover {
            border-color: #007AFF;
            color: #007AFF;
        }
        
        .mode-btn.active {
            background: #007AFF;
            color: white;
            border-color: #007AFF;
        }
        
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .section {
            background: white;
            border: 1px solid #d0d0d0;
            border-radius: 8px;
            padding: 15px;
        }
        
        .section-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .field {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            min-height: 32px;
        }
        
        .field-label {
            width: 100px;
            text-align: right;
            margin-right: 15px;
            color: #666;
            font-size: 13px;
        }
        
        .field-value {
            flex: 1;
            background: #b8d4e8;
            padding: 8px 12px;
            border-radius: 6px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 14px;
            color: #333;
            border: 1px solid #a0c0d8;
        }
        
        .slider-container {
            background: white;
            border: 1px solid #d0d0d0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .slider-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .slider-wrapper {
            position: relative;
            margin: 20px 0;
            text-align: center;
        }
        
        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #e0e0e0;
            outline: none;
            -webkit-appearance: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            border: 2px solid #007AFF;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            border: 2px solid #007AFF;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .slider-labels {
            position: relative;
            margin-top: 10px;
            height: 20px;
            font-size: 12px;
            color: #666;
        }
        
        .slider-labels span {
            position: absolute;
            transform: translateX(-50%);
        }
        
        .slider-value {
            position: relative;
            text-align: center;
            margin-top: 10px;
            font-size: 16px;
            font-weight: 600;
            color: #007AFF;
            font-family: 'Monaco', 'Menlo', monospace;
            background: #f5f5f5;
            border: 2px solid #d0d0d0;
            border-radius: 8px;
            padding: 8px 16px;
            display: inline-block;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .bottom-section {
            display: flex;
            gap: 20px;
        }
        
        .input-section {
            flex: 1;
            background: white;
            border: 1px solid #d0d0d0;
            border-radius: 8px;
            padding: 15px;
        }
        
        .input-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .input-field {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #d0d0d0;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .cidr-input {
            width: 60px;
            text-align: center;
        }
        
        .btn {
            padding: 8px 16px;
            border: 1px solid #d0d0d0;
            border-radius: 4px;
            background: #f0f0f0;
            cursor: pointer;
            font-size: 14px;
        }
        
        .btn:hover {
            background: #e0e0e0;
        }
        
        .btn-primary {
            background: #007AFF;
            color: white;
            border-color: #007AFF;
        }
        
        .btn-primary:hover {
            background: #0056CC;
        }
        
        .subnet-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .subnet-field {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .subnet-value {
            background: #b8d4e8;
            padding: 6px 10px;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 13px;
            border: 1px solid #a0c0d8;
        }
        
        .class-indicators {
            display: flex;
            gap: 8px;
        }
        
        .class-indicator {
            width: 30px;
            height: 30px;
            border: 1px solid #d0d0d0;
            border-radius: 4px;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            color: #999;
            transition: all 0.2s ease;
        }
        
        .class-indicator.active {
            background: #007AFF;
            color: white;
            border-color: #007AFF;
        }
        
        .private-indicator {
            background: #ff4444;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }
        
        /* VLSM Styles */
        .vlsm-view {
            background: white;
            border: 1px solid #d0d0d0;
            border-radius: 8px;
            padding: 20px;
        }
        
        .vlsm-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .vlsm-table th {
            background: #007AFF;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
            border-bottom: 2px solid #0056CC;
        }
        
        .vlsm-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #e0e0e0;
            font-size: 13px;
        }
        
        .vlsm-table tr:hover {
            background: #f8f8f8;
        }
        
        .vlsm-table tr:last-child td {
            border-bottom: none;
        }
        
        .vlsm-cidr {
            font-weight: 600;
            color: #007AFF;
            font-family: 'Monaco', 'Menlo', monospace;
            cursor: pointer;
            text-decoration: underline;
            transition: color 0.2s ease;
        }
        
        .vlsm-cidr:hover {
            color: #0056CC;
        }
        
        .vlsm-range {
            font-family: 'Monaco', 'Menlo', monospace;
            color: #333;
        }
        
        .vlsm-count {
            font-weight: 600;
            color: #666;
        }
        
        .vlsm-note {
            text-align: center;
            padding: 30px;
            color: #999;
            font-style: italic;
        }
        
        .vlsm-expanded {
            margin-top: 20px;
            background: #f8f8f8;
            border: 1px solid #d0d0d0;
            border-radius: 8px;
            padding: 15px;
        }
        
        .vlsm-expanded-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            font-size: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .vlsm-back-btn {
            background: #007AFF;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
        }
        
        .vlsm-back-btn:hover {
            background: #0056CC;
        }
        
        .vlsm-subnet-list {
            max-height: 500px;
            overflow-y: auto;
        }
        
        .vlsm-subnet-item {
            background: white;
            border: 1px solid #d0d0d0;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 10px;
        }
        
        .vlsm-subnet-header {
            font-weight: 600;
            color: #007AFF;
            margin-bottom: 8px;
            font-family: 'Monaco', 'Menlo', monospace;
        }
        
        .vlsm-subnet-header:hover {
            color: #0056CC;
            text-decoration: underline;
        }
        
        .vlsm-subnet-detail {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
            font-size: 13px;
        }
        
        .vlsm-subnet-label {
            color: #666;
        }
        
        .vlsm-subnet-value {
            font-family: 'Monaco', 'Menlo', monospace;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="window">
        <div class="titlebar">
            <div class="traffic-lights">
                <div class="traffic-light red"></div>
                <div class="traffic-light yellow"></div>
                <div class="traffic-light gray"></div>
            </div>
            <div class="title">IPv4 Calculator</div>
            <button class="about-btn">i</button>
        </div>
        
        <div class="content">
            <div class="mode-toggle">
                <button class="mode-btn active" id="details-mode-btn">Network Details</button>
                <button class="mode-btn" id="vlsm-mode-btn">VLSM Subnets</button>
            </div>
            
            <div class="bottom-section">
                <div class="input-section">
                    <div style="font-weight: 600; margin-bottom: 15px;">Enter your IP address</div>
                    <div class="input-group">
                        <label>IP address</label>
                        <input type="text" class="input-field" id="ip-input" value="192.168.1.0">
                        <span>/</span>
                        <input type="number" class="input-field cidr-input" id="cidr-input" value="24" min="0" max="32">
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn" id="clear-btn">Clear</button>
                        <button class="btn btn-primary" id="calculate-btn">Calculate</button>
                    </div>
                </div>
                
                <div class="input-section">
                    <div style="font-weight: 600; margin-bottom: 15px;">Subnets</div>
                    <div class="subnet-info">
                        <div class="subnet-field">
                            <label>Subnet mask</label>
                            <div class="subnet-value" id="subnet-mask-display">255.255.255.0</div>
                        </div>
                        <div class="class-indicators">
                            <span class="class-indicator" id="class-a">A</span>
                            <span class="class-indicator" id="class-b">B</span>
                            <span class="class-indicator" id="class-c">C</span>
                            <span class="class-indicator" id="class-d">D</span>
                            <span class="class-indicator" id="class-e">E</span>
                        </div>
                    </div>
                    <div class="subnet-info">
                        <div class="subnet-field">
                            <label>Hosts/Subnets</label>
                            <div class="subnet-value" id="hosts-subnets">254 / 1</div>
                        </div>
                        <div class="private-indicator" id="private-indicator">Private</div>
                    </div>
                </div>
            </div>
            
            <div class="slider-container">
                <div class="slider-title">Subnet CIDR</div>
                <div class="slider-wrapper">
                    <input type="range" min="2" max="32" value="24" class="slider" id="cidr-slider">
                    <div class="slider-value" id="slider-value">/24</div>
                </div>
            </div>
            
            <div id="details-view">
                <div class="grid">
                    <div class="section">
                        <div class="section-title">Decimal</div>
                        <div class="field">
                            <div class="field-label">IP address:</div>
                            <div class="field-value" id="dec-ip">192.168.1.0</div>
                        </div>
                        <div class="field">
                            <div class="field-label">Subnet mask:</div>
                            <div class="field-value" id="dec-mask">255.255.255.0</div>
                        </div>
                        <div class="field">
                            <div class="field-label">Network:</div>
                            <div class="field-value" id="dec-network">192.168.1.0</div>
                        </div>
                        <div class="field">
                            <div class="field-label">Broadcast:</div>
                            <div class="field-value" id="dec-broadcast">192.168.1.255</div>
                        </div>
                        <div class="field">
                            <div class="field-label">First IP:</div>
                            <div class="field-value" id="dec-first">192.168.1.1</div>
                        </div>
                        <div class="field">
                            <div class="field-label">Last IP:</div>
                            <div class="field-value" id="dec-last">192.168.1.254</div>
                        </div>
                        <div class="field">
                            <div class="field-label">Wildcard:</div>
                            <div class="field-value" id="dec-wildcard">0.0.0.255</div>
                        </div>
                    </div>
                    
                    <div class="section">
                        <div class="section-title">Octal</div>
                        <div class="field">
                            <div class="field-label">IP address:</div>
                            <div class="field-value" id="oct-ip">300.250.1.0</div>
                        </div>
                        <div class="field">
                            <div class="field-label">Subnet mask:</div>
                            <div class="field-value" id="oct-mask">377.377.377.0</div>
                        </div>
                        <div class="field">
                            <div class="field-label">Network:</div>
                            <div class="field-value" id="oct-network">300.250.1.0</div>
                        </div>
                        <div class="field">
                            <div class="field-label">Broadcast:</div>
                            <div class="field-value" id="oct-broadcast">300.250.1.377</div>
                        </div>
                        <div class="field">
                            <div class="field-label">First IP:</div>
                            <div class="field-value" id="oct-first">300.250.1.1</div>
                        </div>
                        <div class="field">
                            <div class="field-label">Last IP:</div>
                            <div class="field-value" id="oct-last">300.250.1.376</div>
                        </div>
                        <div class="field">
                            <div class="field-label">Wildcard:</div>
                            <div class="field-value" id="oct-wildcard">0.0.0.377</div>
                        </div>
                    </div>
                    
                    <div class="section">
                        <div class="section-title">Hexadecimal</div>
                        <div class="field">
                            <div class="field-label">IP address:</div>
                            <div class="field-value" id="hex-ip">c0.a8.1.0</div>
                        </div>
                        <div class="field">
                            <div class="field-label">Subnet mask:</div>
                            <div class="field-value" id="hex-mask">ff.ff.ff.0</div>
                        </div>
                        <div class="field">
                            <div class="field-label">Network:</div>
                            <div class="field-value" id="hex-network">c0.a8.1.0</div>
                        </div>
                        <div class="field">
                            <div class="field-label">Broadcast:</div>
                            <div class="field-value" id="hex-broadcast">c0.a8.1.ff</div>
                        </div>
                        <div class="field">
                            <div class="field-label">First IP:</div>
                            <div class="field-value" id="hex-first">c0.a8.1.1</div>
                        </div>
                        <div class="field">
                            <div class="field-label">Last IP:</div>
                            <div class="field-value" id="hex-last">c0.a8.1.fe</div>
                        </div>
                        <div class="field">
                            <div class="field-label">Wildcard:</div>
                            <div class="field-value" id="hex-wildcard">0.0.0.ff</div>
                        </div>
                    </div>
                    
                    <div class="section">
                        <div class="section-title">Binary</div>
                        <div class="field">
                            <div class="field-label">IP address:</div>
                            <div class="field-value" id="bin-ip">11000000.10101000.00000001.00000000</div>
                        </div>
                        <div class="field">
                            <div class="field-label">Subnet mask:</div>
                            <div class="field-value" id="bin-mask">11111111.11111111.11111111.00000000</div>
                        </div>
                        <div class="field">
                            <div class="field-label">Network:</div>
                            <div class="field-value" id="bin-network">11000000.10101000.00000001.00000000</div>
                        </div>
                        <div class="field">
                            <div class="field-label">Broadcast:</div>
                            <div class="field-value" id="bin-broadcast">11000000.10101000.00000001.11111111</div>
                        </div>
                        <div class="field">
                            <div class="field-label">First IP:</div>
                            <div class="field-value" id="bin-first">11000000.10101000.00000001.00000001</div>
                        </div>
                        <div class="field">
                            <div class="field-label">Last IP:</div>
                            <div class="field-value" id="bin-last">11000000.10101000.00000001.11111110</div>
                        </div>
                        <div class="field">
                            <div class="field-label">Wildcard:</div>
                            <div class="field-value" id="bin-wildcard">00000000.00000000.00000000.11111111</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="vlsm-view" id="vlsm-view" style="display: none;">
                <h3 style="text-align: center; margin-bottom: 20px; color: #333;">VLSM Subnet Breakdown</h3>
                <div id="vlsm-content"></div>
            </div>
            
            <div style="text-align: center; margin-top: 20px; color: #888; font-size: 12px;">
                © 2025 - Chris Smolen
            </div>
        </div>
    </div>

    <!-- About Modal -->
    <div class="about-modal" id="about-modal">
        <div class="about-content">
            <div class="about-title">IPv4 Calculator</div>
            <div class="about-info">
                <strong>Created by:</strong> Chris Smolen<br>
                <strong>Version:</strong> 2.0<br>
                <strong>Copyright:</strong> © 2025<br><br>
                <a href="https://github.com/smolz/ip-calculator-v4" class="about-link" target="_blank">
                    https://github.com/smolz/ip-calculator-v4
                </a>
            </div>
            <button class="close-about" id="close-about">Close</button>
        </div>
    </div>

    <script>
        let calculator; // Global variable for onclick handlers
        
        class IPCalculator {
            constructor() {
                this.currentMode = 'details';
                this.initElements();
                this.bindEvents();
                this.calculate();
            }
            
            initElements() {
                this.ipInput = document.getElementById('ip-input');
                this.cidrInput = document.getElementById('cidr-input');
                this.cidrSlider = document.getElementById('cidr-slider');
                this.calculateBtn = document.getElementById('calculate-btn');
                this.clearBtn = document.getElementById('clear-btn');
                this.detailsModeBtn = document.getElementById('details-mode-btn');
                this.vlsmModeBtn = document.getElementById('vlsm-mode-btn');
                this.detailsView = document.getElementById('details-view');
                this.vlsmView = document.getElementById('vlsm-view');
            }
            
            bindEvents() {
                this.calculateBtn.addEventListener('click', () => this.calculate());
                this.clearBtn.addEventListener('click', () => this.clear());
                this.cidrSlider.addEventListener('input', (e) => {
                    this.cidrInput.value = e.target.value;
                    this.updateSliderValue(e.target.value);
                    this.calculate();
                });
                this.cidrInput.addEventListener('input', (e) => {
                    this.cidrSlider.value = e.target.value;
                    this.updateSliderValue(e.target.value);
                    this.calculate();
                });
                this.ipInput.addEventListener('keyup', (e) => {
                    if (e.key === 'Enter') this.calculate();
                });
                
                // Mode toggle events
                this.detailsModeBtn.addEventListener('click', () => this.switchMode('details'));
                this.vlsmModeBtn.addEventListener('click', () => this.switchMode('vlsm'));
                
                // About modal events
                document.querySelector('.about-btn').addEventListener('click', () => {
                    document.getElementById('about-modal').style.display = 'flex';
                });
                
                document.getElementById('close-about').addEventListener('click', () => {
                    document.getElementById('about-modal').style.display = 'none';
                });
                
                // Close modal when clicking outside
                document.getElementById('about-modal').addEventListener('click', (e) => {
                    if (e.target === document.getElementById('about-modal')) {
                        document.getElementById('about-modal').style.display = 'none';
                    }
                });
            }
            
            switchMode(mode) {
                this.currentMode = mode;
                
                if (mode === 'details') {
                    this.detailsModeBtn.classList.add('active');
                    this.vlsmModeBtn.classList.remove('active');
                    this.detailsView.style.display = 'block';
                    this.vlsmView.style.display = 'none';
                } else {
                    this.detailsModeBtn.classList.remove('active');
                    this.vlsmModeBtn.classList.add('active');
                    this.detailsView.style.display = 'none';
                    this.vlsmView.style.display = 'block';
                    this.generateVLSM();
                }
            }
            
            generateVLSM() {
                const ip = this.ipInput.value.trim();
                const cidr = parseInt(this.cidrInput.value);
                
                if (!ip || !this.isValidIP(ip) || cidr >= 32) {
                    document.getElementById('vlsm-content').innerHTML = 
                        '<div class="vlsm-note">Enter a valid network address with CIDR /31 or lower to see subnet breakdown</div>';
                    return;
                }
                
                const networkInt = this.ipToInt(ip) & ((0xFFFFFFFF << (32 - cidr)) >>> 0);
                const networkIP = this.intToIp(networkInt);
                
                let html = '<table class="vlsm-table">';
                html += '<thead><tr>';
                html += '<th>Subnet Size</th>';
                html += '<th>CIDR</th>';
                html += '<th>Subnet Mask</th>';
                html += '<th>Number of Subnets</th>';
                html += '<th>Hosts per Subnet</th>';
                html += '<th>First Subnet Range</th>';
                html += '</tr></thead>';
                html += '<tbody>';
                
                // Generate rows for each possible subnet size from current CIDR + 1 to /32
                for (let newCidr = cidr + 1; newCidr <= 32; newCidr++) {
                    const numSubnets = Math.pow(2, newCidr - cidr);
                    const subnetSize = Math.pow(2, 32 - newCidr);
                    const subnetMask = this.cidrToMask(newCidr);
                    
                    // Calculate hosts per subnet based on CIDR
                    let hostsPerSubnet;
                    let hostsDisplay;
                    if (newCidr === 32) {
                        hostsPerSubnet = 1;
                        hostsDisplay = '1 (host route)';
                    } else if (newCidr === 31) {
                        hostsPerSubnet = 2;
                        hostsDisplay = '2 (point-to-point)';
                    } else {
                        hostsPerSubnet = Math.pow(2, 32 - newCidr) - 2;
                        hostsDisplay = hostsPerSubnet.toLocaleString();
                    }
                    
                    // Calculate first subnet range
                    const firstSubnetNetwork = networkInt;
                    const firstSubnetBroadcast = firstSubnetNetwork + subnetSize - 1;
                    
                    let rangeStr;
                    if (newCidr === 32) {
                        rangeStr = this.intToIp(firstSubnetNetwork);
                    } else if (newCidr === 31) {
                        const ip1 = this.intToIp(firstSubnetNetwork);
                        const ip2 = this.intToIp(firstSubnetNetwork + 1);
                        rangeStr = `${ip1}, ${ip2}`;
                    } else {
                        const firstIP = this.intToIp(firstSubnetNetwork + 1);
                        const lastIP = this.intToIp(firstSubnetBroadcast - 1);
                        rangeStr = `${firstIP} - ${lastIP}`;
                    }
                    
                    html += '<tr>';
                    html += `<td class="vlsm-count">${subnetSize.toLocaleString()} ${subnetSize === 1 ? 'IP' : 'IPs'}</td>`;
                    html += `<td><span class="vlsm-cidr" onclick="calculator.showSubnetDetails(${newCidr})">/${newCidr}</span></td>`;
                    html += `<td class="vlsm-range">${subnetMask}</td>`;
                    html += `<td class="vlsm-count">${numSubnets.toLocaleString()}</td>`;
                    html += `<td class="vlsm-count">${hostsDisplay}</td>`;
                    html += `<td class="vlsm-range">${rangeStr}</td>`;
                    html += '</tr>';
                }
                
                html += '</tbody></table>';
                html += '<div id="vlsm-expanded-view"></div>';
                document.getElementById('vlsm-content').innerHTML = html;
            }
            
            loadSubnet(network, cidr) {
                this.ipInput.value = network;
                this.cidrInput.value = cidr;
                this.cidrSlider.value = cidr;
                this.updateSliderValue(cidr);
                this.calculate();
                // Stay on VLSM view and regenerate
                if (this.currentMode === 'vlsm') {
                    this.generateVLSM();
                }
            }
            
            showSubnetDetails(targetCidr) {
                const ip = this.ipInput.value.trim();
                const cidr = parseInt(this.cidrInput.value);
                
                const networkInt = this.ipToInt(ip) & ((0xFFFFFFFF << (32 - cidr)) >>> 0);
                const numSubnets = Math.pow(2, targetCidr - cidr);
                const subnetSize = Math.pow(2, 32 - targetCidr);
                const subnetMask = this.cidrToMask(targetCidr);
                
                // Calculate hosts per subnet based on CIDR
                let hostsPerSubnet;
                let hostsDisplay;
                if (targetCidr === 32) {
                    hostsPerSubnet = 1;
                    hostsDisplay = '1 (host route)';
                } else if (targetCidr === 31) {
                    hostsPerSubnet = 2;
                    hostsDisplay = '2 (point-to-point)';
                } else {
                    hostsPerSubnet = Math.pow(2, 32 - targetCidr) - 2;
                    hostsDisplay = hostsPerSubnet.toLocaleString();
                }
                
                let html = '<div class="vlsm-expanded">';
                html += '<div class="vlsm-expanded-title">';
                html += `<span>All /${targetCidr} Subnets (${numSubnets.toLocaleString()} total)</span>`;
                html += '<button class="vlsm-back-btn" onclick="calculator.generateVLSM()">← Back</button>';
                html += '</div>';
                html += '<div class="vlsm-subnet-list">';
                
                for (let i = 0; i < numSubnets; i++) {
                    const subnetNetwork = networkInt + (i * subnetSize);
                    const subnetBroadcast = subnetNetwork + subnetSize - 1;
                    const network = this.intToIp(subnetNetwork);
                    
                    html += '<div class="vlsm-subnet-item">';
                    html += `<div class="vlsm-subnet-header" onclick="calculator.loadSubnet('${network}', ${targetCidr})" style="cursor: pointer;">Subnet ${i + 1}: ${network}/${targetCidr}</div>`;
                    html += '<div class="vlsm-subnet-detail">';
                    html += '<span class="vlsm-subnet-label">Subnet Mask:</span>';
                    html += `<span class="vlsm-subnet-value">${subnetMask}</span>`;
                    html += '</div>';
                    html += '<div class="vlsm-subnet-detail">';
                    html += '<span class="vlsm-subnet-label">Network:</span>';
                    html += `<span class="vlsm-subnet-value">${network}</span>`;
                    html += '</div>';
                    
                    if (targetCidr === 32) {
                        // /32 - single host
                        html += '<div class="vlsm-subnet-detail">';
                        html += '<span class="vlsm-subnet-label">Host Address:</span>';
                        html += `<span class="vlsm-subnet-value">${network}</span>`;
                        html += '</div>';
                        html += '<div class="vlsm-subnet-detail">';
                        html += '<span class="vlsm-subnet-label">Type:</span>';
                        html += `<span class="vlsm-subnet-value">Host Route</span>`;
                        html += '</div>';
                    } else if (targetCidr === 31) {
                        // /31 - point-to-point (RFC 3021)
                        const ip1 = network;
                        const ip2 = this.intToIp(subnetNetwork + 1);
                        html += '<div class="vlsm-subnet-detail">';
                        html += '<span class="vlsm-subnet-label">Point-to-Point IPs:</span>';
                        html += `<span class="vlsm-subnet-value">${ip1}, ${ip2}</span>`;
                        html += '</div>';
                        html += '<div class="vlsm-subnet-detail">';
                        html += '<span class="vlsm-subnet-label">Type:</span>';
                        html += `<span class="vlsm-subnet-value">Point-to-Point Link</span>`;
                        html += '</div>';
                    } else {
                        // Normal subnet
                        const broadcast = this.intToIp(subnetBroadcast);
                        const firstIP = this.intToIp(subnetNetwork + 1);
                        const lastIP = this.intToIp(subnetBroadcast - 1);
                        
                        html += '<div class="vlsm-subnet-detail">';
                        html += '<span class="vlsm-subnet-label">Broadcast:</span>';
                        html += `<span class="vlsm-subnet-value">${broadcast}</span>`;
                        html += '</div>';
                        html += '<div class="vlsm-subnet-detail">';
                        html += '<span class="vlsm-subnet-label">Usable Range:</span>';
                        html += `<span class="vlsm-subnet-value">${firstIP} - ${lastIP}</span>`;
                        html += '</div>';
                        html += '<div class="vlsm-subnet-detail">';
                        html += '<span class="vlsm-subnet-label">Usable Hosts:</span>';
                        html += `<span class="vlsm-subnet-value">${hostsDisplay}</span>`;
                        html += '</div>';
                    }
                    
                    html += '</div>';
                }
                
                html += '</div></div>';
                document.getElementById('vlsm-expanded-view').innerHTML = html;
                
                // Scroll to the expanded view
                document.getElementById('vlsm-expanded-view').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
            
            getIPClass(firstOctet) {
                if (firstOctet >= 0 && firstOctet <= 127) return 'A';
                if (firstOctet >= 128 && firstOctet <= 191) return 'B';
                if (firstOctet >= 192 && firstOctet <= 223) return 'C';
                if (firstOctet >= 224 && firstOctet <= 239) return 'D';
                if (firstOctet >= 240 && firstOctet <= 255) return 'E';
                return null;
            }
            
            updateClassIndicators(ipClass) {
                ['a', 'b', 'c', 'd', 'e'].forEach(c => {
                    const el = document.getElementById(`class-${c}`);
                    if (c.toUpperCase() === ipClass) {
                        el.classList.add('active');
                    } else {
                        el.classList.remove('active');
                    }
                });
            }
            
            clear() {
                this.ipInput.value = '';
                this.cidrInput.value = '24';
                this.cidrSlider.value = '24';
                this.updateSliderValue('24');
            }
            
            updateSliderValue(value) {
                const sliderValue = document.getElementById('slider-value');
                sliderValue.textContent = '/' + value;
            }
            
            ipToInt(ip) {
                return ip.split('.').reduce((acc, octet) => (acc << 8) + parseInt(octet), 0) >>> 0;
            }
            
            intToIp(int) {
                return [
                    (int >>> 24) & 255,
                    (int >>> 16) & 255,
                    (int >>> 8) & 255,
                    int & 255
                ].join('.');
            }
            
            cidrToMask(cidr) {
                const mask = (0xFFFFFFFF << (32 - cidr)) >>> 0;
                return this.intToIp(mask);
            }
            
            ipToBinary(ip) {
                return ip.split('.').map(octet => 
                    parseInt(octet).toString(2).padStart(8, '0')
                ).join('.');
            }
            
            ipToHex(ip) {
                return ip.split('.').map(octet => 
                    parseInt(octet).toString(16)
                ).join('.');
            }
            
            ipToOctal(ip) {
                return ip.split('.').map(octet => 
                    parseInt(octet).toString(8)
                ).join('.');
            }
            
            getSpecialAddressInfo(ip) {
                const ipInt = this.ipToInt(ip);
                
                // Check special address blocks in order
                const specialBlocks = [
                    { start: '0.0.0.0', end: '0.255.255.255', label: 'Local', rfc: 'RFC6890', url: 'https://datatracker.ietf.org/doc/html/rfc6890' },
                    { start: '10.0.0.0', end: '10.255.255.255', label: 'Private', rfc: 'RFC1918', url: 'https://datatracker.ietf.org/doc/html/rfc1918' },
                    { start: '100.64.0.0', end: '100.127.255.255', label: 'CGN', rfc: 'RFC6598', url: 'https://datatracker.ietf.org/doc/html/rfc6598' },
                    { start: '127.0.0.0', end: '127.255.255.255', label: 'Loopback', rfc: 'RFC6890', url: 'https://datatracker.ietf.org/doc/html/rfc6890' },
                    { start: '169.254.0.0', end: '169.254.255.255', label: 'Link-Local', rfc: 'RFC3927', url: 'https://datatracker.ietf.org/doc/html/rfc3927' },
                    { start: '172.16.0.0', end: '172.31.255.255', label: 'Private', rfc: 'RFC1918', url: 'https://datatracker.ietf.org/doc/html/rfc1918' },
                    { start: '192.0.0.0', end: '192.0.0.255', label: 'Reserved', rfc: 'RFC6890', url: 'https://datatracker.ietf.org/doc/html/rfc6890' },
                    { start: '192.0.2.0', end: '192.0.2.255', label: 'Documentation', rfc: 'RFC5737', url: 'https://datatracker.ietf.org/doc/html/rfc5737' },
                    { start: '192.88.99.0', end: '192.88.99.255', label: 'Reserved', rfc: 'RFC7526', url: 'https://datatracker.ietf.org/doc/html/rfc7526' },
                    { start: '192.168.0.0', end: '192.168.255.255', label: 'Private', rfc: 'RFC1918', url: 'https://datatracker.ietf.org/doc/html/rfc1918' },
                    { start: '198.18.0.0', end: '198.19.255.255', label: 'Testing', rfc: 'RFC2544', url: 'https://datatracker.ietf.org/doc/html/rfc2544' },
                    { start: '198.51.100.0', end: '198.51.100.255', label: 'Documentation', rfc: 'RFC5737', url: 'https://datatracker.ietf.org/doc/html/rfc5737' },
                    { start: '203.0.113.0', end: '203.0.113.255', label: 'Documentation', rfc: 'RFC5737', url: 'https://datatracker.ietf.org/doc/html/rfc5737' },
                    { start: '224.0.0.0', end: '239.255.255.255', label: 'Multicast', rfc: 'RFC5771', url: 'https://datatracker.ietf.org/doc/html/rfc5771' },
                    { start: '233.252.0.0', end: '233.252.0.255', label: 'Documentation', rfc: 'RFC6676', url: 'https://datatracker.ietf.org/doc/html/rfc6676' },
                    { start: '240.0.0.0', end: '255.255.255.254', label: 'Reserved', rfc: 'RFC3232', url: 'https://datatracker.ietf.org/doc/html/rfc3232' },
                    { start: '255.255.255.255', end: '255.255.255.255', label: 'Broadcast', rfc: 'RFC6890', url: 'https://datatracker.ietf.org/doc/html/rfc6890' }
                ];
                
                for (const block of specialBlocks) {
                    const startInt = this.ipToInt(block.start);
                    const endInt = this.ipToInt(block.end);
                    
                    if (ipInt >= startInt && ipInt <= endInt) {
                        return block;
                    }
                }
                
                // If not in any special block, it's public
                return { label: 'Public', rfc: null, url: null };
            }
            
            calculate() {
                const ip = this.ipInput.value.trim();
                const cidr = parseInt(this.cidrInput.value);
                
                if (!ip || !this.isValidIP(ip)) {
                    return;
                }
                
                const ipInt = this.ipToInt(ip);
                const maskInt = (0xFFFFFFFF << (32 - cidr)) >>> 0;
                const wildcardInt = ~maskInt >>> 0;
                const networkInt = ipInt & maskInt;
                const broadcastInt = networkInt | wildcardInt;
                
                const mask = this.intToIp(maskInt);
                const wildcard = this.intToIp(wildcardInt);
                const network = this.intToIp(networkInt);
                const broadcast = this.intToIp(broadcastInt);
                const firstIP = this.intToIp(networkInt + 1);
                const lastIP = this.intToIp(broadcastInt - 1);
                
                // Update decimal values
                document.getElementById('dec-ip').textContent = ip;
                document.getElementById('dec-mask').textContent = mask;
                document.getElementById('dec-network').textContent = network;
                document.getElementById('dec-broadcast').textContent = broadcast;
                document.getElementById('dec-first').textContent = firstIP;
                document.getElementById('dec-last').textContent = lastIP;
                document.getElementById('dec-wildcard').textContent = wildcard;
                
                // Update octal values
                document.getElementById('oct-ip').textContent = this.ipToOctal(ip);
                document.getElementById('oct-mask').textContent = this.ipToOctal(mask);
                document.getElementById('oct-network').textContent = this.ipToOctal(network);
                document.getElementById('oct-broadcast').textContent = this.ipToOctal(broadcast);
                document.getElementById('oct-first').textContent = this.ipToOctal(firstIP);
                document.getElementById('oct-last').textContent = this.ipToOctal(lastIP);
                document.getElementById('oct-wildcard').textContent = this.ipToOctal(wildcard);
                
                // Update hex values
                document.getElementById('hex-ip').textContent = this.ipToHex(ip);
                document.getElementById('hex-mask').textContent = this.ipToHex(mask);
                document.getElementById('hex-network').textContent = this.ipToHex(network);
                document.getElementById('hex-broadcast').textContent = this.ipToHex(broadcast);
                document.getElementById('hex-first').textContent = this.ipToHex(firstIP);
                document.getElementById('hex-last').textContent = this.ipToHex(lastIP);
                document.getElementById('hex-wildcard').textContent = this.ipToHex(wildcard);
                
                // Update binary values
                document.getElementById('bin-ip').textContent = this.ipToBinary(ip);
                document.getElementById('bin-mask').textContent = this.ipToBinary(mask);
                document.getElementById('bin-network').textContent = this.ipToBinary(network);
                document.getElementById('bin-broadcast').textContent = this.ipToBinary(broadcast);
                document.getElementById('bin-first').textContent = this.ipToBinary(firstIP);
                document.getElementById('bin-last').textContent = this.ipToBinary(lastIP);
                document.getElementById('bin-wildcard').textContent = this.ipToBinary(wildcard);
                
                // Update subnet info
                document.getElementById('subnet-mask-display').textContent = mask;
                
                // Get IP class
                const firstOctet = parseInt(ip.split('.')[0]);
                const ipClass = this.getIPClass(firstOctet);
                this.updateClassIndicators(ipClass);
                
                // Calculate hosts per subnet and number of subnets from classful network
                const hostsPerSubnet = cidr >= 31 ? 0 : Math.pow(2, 32 - cidr) - 2;
                
                // Calculate subnets based on classful boundary
                let classfulCIDR = 8; // Class A default
                if (firstOctet >= 128 && firstOctet <= 191) classfulCIDR = 16; // Class B
                else if (firstOctet >= 192 && firstOctet <= 223) classfulCIDR = 24; // Class C
                
                const totalSubnets = cidr < classfulCIDR ? 1 : Math.pow(2, cidr - classfulCIDR);
                document.getElementById('hosts-subnets').textContent = `${hostsPerSubnet} / ${totalSubnets.toLocaleString()}`;
                
                // Update address type indicator with reference link
                const privateIndicator = document.getElementById('private-indicator');
                const addressInfo = this.getSpecialAddressInfo(ip);
                
                // Set label text and reference link
                if (addressInfo.rfc) {
                    privateIndicator.innerHTML = `${addressInfo.label} <a href="${addressInfo.url}" target="_blank" style="color: white; text-decoration: underline; margin-left: 4px;">Reference</a>`;
                } else {
                    privateIndicator.textContent = addressInfo.label;
                }
                
                // Set background color based on label type
                const colorMap = {
                    'Private': '#ff4444',
                    'Public': '#44aa44',
                    'Local': '#ff8800',
                    'Loopback': '#9966ff',
                    'Link-Local': '#ff8800',
                    'CGN': '#ff8800',
                    'Reserved': '#888888',
                    'Documentation': '#3399ff',
                    'Testing': '#3399ff',
                    'Multicast': '#cc66ff',
                    'Broadcast': '#ff0066'
                };
                privateIndicator.style.background = colorMap[addressInfo.label] || '#888888';
                
                // Update VLSM if in that mode
                if (this.currentMode === 'vlsm') {
                    this.generateVLSM();
                }
            }
            
            isValidIP(ip) {
                const parts = ip.split('.');
                if (parts.length !== 4) return false;
                return parts.every(part => {
                    const num = parseInt(part);
                    return !isNaN(num) && num >= 0 && num <= 255;
                });
            }
        }
        
        // Initialize the calculator when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            calculator = new IPCalculator();
        });
    </script>
</body>
</html>
